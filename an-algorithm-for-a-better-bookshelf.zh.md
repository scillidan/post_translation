# [更好的书架算法：管理空白空间的战略定位。](https://cacm.acm.org/news/an-algorithm-for-a-better-bookshelf/)

走进图书馆，你可能会注意到大多数书架并不满——图书管理员会在每个书架上留下一些空余空间。这样，当他们得到新书时，就可以将它们放入适当的位置，而不必移动太多其他书籍。

这是一个简单的想法，但在计算机科学中的许多涉及排序数据的场合中，这个问题却显得尤为重要，例如按字母顺序排列的人口普查资料库，或社交网络成员之间的连接列表。在这些情况下，条目的数量可能达到数百亿，空白空间的战略定位显得极为重要。

“随着我们获取的数据越来越多，问题也变得越来越大，”乔治亚理工学院（Georgia Tech）计算科学与工程学院的助理教授Helen Xu说。“在这些规模下，有效管理如何添加新条目变得至关重要。”

书架问题（计算机科学家称之为“列表标记”问题）是数据结构领域中最基本的话题之一。“这是你会教给大一或大二本科生的那种问题，”卡内基梅隆大学计算机科学教授Guy Blelloch表示。

然而直到最近，计算机科学家在算法上所能实现在理论上应该能够移动的书籍数量之间存在着较大的差距。在算法方面，“在30年或更长时间内，几乎没有进展，”Blelloch说道。

现在，研究人员提出了一种接近理论下限的新算法。Blelloch将其描述为“一个非常优雅的结果。”

这一新方法“希望能够打开列表标记的新应用领域，在这些领域，之前由于成本不可行而未能发挥作用，”卡内基梅隆大学计算机科学助理教授William Kuszmaul表示，他是提出新算法的研究人员之一。

列表标记问题的起点是一个大小为*n*的书架，以及一些上限——例如，75%或90%——表明你允许填充的书架程度。书籍有一定的排序（例如，按作者的字母顺序），随着书籍逐一到达，你为它们选择符合排序要求的位置，并根据需要移动其他书籍。为了寻找在多种不同条件下都能稳健进行的书籍放置算法，计算机科学家假设这些书籍是由一个敌对者发送的，该敌对者知道算法并试图迫使你移动尽可能多的书籍。（在某些版本的问题中，敌对者也可能会移除书籍。）

如果你使用最天真的算法——即将每本书尽可能靠近书架的开头放置——那么你的敌对者可以迫使你移动你已经放置的每一本书，仅仅通过发送那些在你已经发送的每一本书之前的书籍。随着书架的填满，适应新书籍的成本与*n*成正比。

1981年，计算机科学家们提出了一种更好的算法，其新增书籍的平均成本仅约为log<sup>2</sup>*n*。该算法首先将书架分为两个相等的部分；然后又将每个部分分成两部分，以此类推。对于每种不同的规模，算法设定了允许书籍填充的密度阈值，允许小部分比大部分更加饱和。当新书到来时，如果新书使某个部分超出了密度阈值，算法会将下一个较大部分的书籍均匀分布，从而缓解小部分的压力。

在随后的几年中，研究人员提交了基于均匀分布书籍的各种变体——称为“平滑”算法。然而，没有人能打破1981年算法的log<sup>2</sup>*n*成本。1990年，计算机科学家们证明没有平滑算法能做到比log<sup>2</sup>*n*更好。尽管如此，转向非平滑算法似乎没有意义——毕竟，如果你的算法故意创建比平均值更高的空位，敌对者就可以针对这些空位，迫使你移动大量书籍。

“Kuszmaul说，“日常信念似乎形成了log<sup>2</sup>*n*应该是最优的，我们作为一个社区应该做的是努力证明这一点。”

焦点从寻找新算法转向为越来越广泛的算法集证明下限。2012年，研究人员证明没有确定算法能改进log<sup>2</sup>*n*。“这一界限是多么强大和稳固，”新论文的作者之一、斯托尼布鲁克大学的Michael Bender表示。

结合早期的结果，“这意味着要打破log<sup>2</sup>*n*，你必须同时具有随机性和非平滑性，并且要以有意义的方式做到这两点，”Kuszmaul说。

如何实现这一目标的第一个曙光来自一个意想不到的方向：隐私研究。2016年，Bender和其他研究人员让计算机科学家震惊，他们证明可以创建具有“历史独立性”的书架算法而不会增加log<sup>2</sup>*n*成本。 如果一个算法是历史独立的，则书架的当前状态不会显示任何关于插入和删除的先前历史的信息，仅仅显示当前在书架上的书籍。

Bender和他的同事们创造历史独立算法是为了其安全属性，但他们逐渐意识到，历史独立性也可以提供算法优势。使用历史独立的算法，敌对者无法利用某种巧妙的插入顺序来影响哪些密集热点会出现——无论插入顺序如何，书架的最终结果都是相同的。这一特征简化了算法需要防范的潜在危险的集合。

在2022年，Bender、Kuszmaul和同事们找到了制作一个历史独立算法的方法，该算法每本书的成本仅为log<sup>1.5</sup>*n*，打破了四十年来的干旱期。他们的算法修改了2016年算法，使其更“懒惰”，正如Kuszmaul所言——该算法不会急于平滑出脆弱的密集点。接下来，研究人员在排书过程中添加了一层随机性，以隐藏这些密集点的位置，以便敌对者无法针对它们。
*研*人员还证明他们的结果是尖锐的：没有历史独立算法能做到比log<sup>1.5</sup>*n*更好。因此，许多计算机科学家猜测，这个新算法可能是书架问题的最终答案。“我们认为这可能是终点，”Kuszmaul表示。

然而，懒惰只是书架算法的两个理想特性的其中一个。还有第二个特性与历史独立性根本不兼容：主动响应敌对者策略的能力。

如果敌对者正在瞄准特定区域，你希望迅速将空位移动到该区域以适应即将到来的书籍。然而，“如果你只是天真地那样做，你就完蛋了，”Kuszmaul说。“敌对者会发现你的做法，并改变行为来干扰你。”

现在，在2024年5月在线发布的一篇论文中，Bender、Kuszmaul及五位同事成功将历史独立性的懒惰优势与对敌对者策略的更主动回应相结合。他们的新算法会根据敌对者的策略进行调整，但在随机选择的时间范围内。“这足够不可预测，以至于敌对者无法利用它，”Kuszmaul说。该算法“兼具两全其美的优点——它表现得像历史独立算法，除非在它策略适应的这个方面。”

新算法的预期成本为log*n* × (log(log*n*))<sup>2</sup>，大大优于log<sup>1.5</sup>*n*。对于大型*n*，log*n*因子远远超过(log(log*n*))<sup>2</sup>因子，这意味着成本仅比log*n*略高，而计算机科学家早已知道这是任何书架算法的理论下限。

这一改进的成本可能使新的算法或其简化版本在新的数据应用中具有价值，Xu表示。尽管许多现实世界的数据设置并非敌对，但没有敌对的情况下，有时也会出现对特定位置数据的突发洪水，她指出。例如，在社交网络中，一位名人可能在一些引人注目的事件之后迅速获得追随者。

“我相信这个算法在现实世界的情况下会带来性能优势，”Bender表示。然而，研究人员警告说，像任何理论进展一样，将新算法转化为在实践中表现良好的东西将需要大量的工作。

Blelloch预测，最近的进展可能会吸引更多研究人员关注书架问题，不仅关注实际实现，还有进一步的理论进展。现在亟待解决的关键问题是，研究人员能否达到log*n*？

如果能的话——以可在现实世界中实现的方式——那么书架算法可能会对当前最广泛使用的排序数据结构：二叉搜索树，形成强有力的竞争。Kuszmaul说，“那时，你实际上会有一个能够改变世界的数据结构。”

他警告说，“在这里和那里之间还有一堆看似不可能的障碍。”

不过，新工作“打开了许多可能性”，Blelloch说。“谁知道我们能做到的最好的结果是什么？也许我们可以达到log*n*。”

## 进一步阅读

- *Bender, M. 等.*  
	**反持久性在持久存储中的应用：历史独立稀疏表和字典。发表于 *第35届ACM SIGMOD-SIGACT-SIGART数据库系统原则研讨会（PODS）*，第289-302页，2016年6月。**
- *Bender, M. 等.*  
	**在线列表标记：突破log<sup>2</sup>*n*障碍。发表于 *IEEE第63届年度计算机科学 Foundations 研讨会（FOCS）*，第980-990页，2022年。**
-  Bulánek, J. 等。  
	**在线标记问题的严格下限。在 *第44届年度ACM理论计算机研讨会（STOC）*，第1185-1198页，2012年。**
- *Bulánek, J. 等.*  
	**关于具有多项式标签的随机在线标记。发表在 *国际自动机、语言和编程研讨会（ICALP）*，计算机科学讲义丛书第7965卷，第291-203页，斯普林格，2013年。**
- *Dietz, P. 和 Zhang, J.*  
	**单调列表标记的下限。在 *斯堪的纳维亚算法理论研讨会，计算机科学讲义丛书第447卷，第173-180页，斯普林格，1990年。**
- *Dietz, P. 等。*  
	**在线单调列表标记的严格下限。 *SIAM离散数学杂志, 18* (3):626-637, 2004。**
- *Itai, A. 等.*  
	**优先队列的稀疏表实现。发表于 *第8届国际自动机、语言和编程研讨会（ICALP），计算机科学讲义丛书第115卷，第417-431页，斯普林格，1981年。**

[GPT-4o mini]
