# [构建自托管产品](https://fusionauth.io/blog/building-self-hostable-application)

在本文中，您将了解创建设计自托管开发工具所需的架构、商业模式和软件设计选择。

## 摘要 - 构建自托管产品

### 关键要点

- **为开发者提供最佳控制：** FusionAuth 的自托管架构使开发者能够对关键身份验证基础设施保持完全控制，从而实现精确的性能调优、自定义网络配置和即时故障排除能力。
- **增强的隐私与合规性：** 借助 FusionAuth 的自托管部署选项，组织可以确保数据位置、遵循加密标准，并符合严苛的监管要求，如 GDPR，而无需依赖第三方数据处理的承诺。
- **优越的可靠性与业务连续性：** FusionAuth 的自托管能力确保即使在提供商停机期间，您的身份验证系统仍然可以继续运作，使您直接监督关键基础设施，并能够在收购或供应商变更期间维持服务。
- **灵活部署无处不在：** FusionAuth 支持 Docker、Kubernetes、物理服务器和云部署，允许您将身份验证基础设施放置在靠近用户的位置，以实现最低延迟，同时适应任何技术环境或预算限制。
- **离线和隔离环境支持：** FusionAuth 的自包含架构可在网络连接有限或无连接的环境中实现身份验证，非常适合高安全场景、开发环境和需要完全数据隔离的地点。
- **成本效益扩展：** FusionAuth 的自托管模式将运营成本转移到您的基础设施，使您能够精确控制成本、进行季节性扩展和优化策略，以符合您的特定使用模式和业务需求。

___

### 定义

- **自托管软件：** 类似于 FusionAuth 的应用程序，可以在客户控制的基础设施上下载和运行，提供部署、配置和数据管理的完全自主权，同时保持所有核心功能。
- **单租户架构：** FusionAuth 的专用实例模型，每个客户运行自己的隔离身份验证系统，确保没有共享资源、增强安全性以及相较于多租户 SaaS 解决方案的完全自定义控制。
- **数据位置：** 控制用户数据地理位置的能力；FusionAuth 的自托管允许遵守地区法规，并消除有关跨境数据转移或未知服务器位置的担忧。
- **隔离部署：** 完全隔离的网络环境，其中 FusionAuth 在没有互联网连接的情况下运行，对于高安全性应用程序、机密系统和需要绝对数据保护的环境至关重要。
- **基础设施即代码（IaC）：** FusionAuth 通过 Terraform 和 API 支持自动化配置管理，使各个开发、测试和生产环境之间的一致、版本控制的部署成为可能。

___

### 常见问题解答

**问：FusionAuth 可以通过 Docker 或 Kubernetes 部署吗？**

答：是的，FusionAuth 提供全面的 Docker 和 Kubernetes 支持，提供官方容器映像、Helm 图表和详细的部署指南。这使得能够无缝集成到现代容器编排平台，同时保持所有自托管的好处，如数据控制和自定义扩展。

**问：我可以在自己的基础设施上部署 FusionAuth 吗？**

答：当然可以。FusionAuth 专为可以在您选择的任何基础设施上自托管而设计——无论是本地服务器、私有云、公共云，还是混合环境。这使您能够完全控制性能、安全性、合规性和成本，同时消除对供应商锁定的顾虑。

**问：FusionAuth 的单租户架构如何增强安全性？**

答：FusionAuth 的单租户方法意味着每个安装都是完全隔离的，具有专用资源，从而消除了多租户系统的“吵闹邻居”风险。您可以控制整个安全堆栈，实施自定义加固措施，并确保没有与其他组织数据共享的攻击面。

**问：如何最小化全球用户的身份验证延迟？**

答：FusionAuth 的自托管能力允许您在地理上靠近用户部署身份验证节点，从而大幅降低网络往返次数。您可以实施多区域部署，优化网络拓扑，使用 CDN 策略，这些都是集中式 SaaS 提供商无法做到的。

**问：FusionAuth 是否与密码管理器和外部身份提供者兼容？**

答：是的，FusionAuth 与流行的密码管理器无缝集成，并通过 SAML、OIDC 和 OAuth2 协议支持与外部身份提供者的联合。自托管架构确保这些集成保持在您的控制之下，并可以根据您的具体工作流程需求进行自定义。

___

FusionAuth 这一产品旨在被 [下载并本地运行](https://fusionauth.io/download)。虽然您可以支付 FusionAuth，这家公司，为您在云中运行 FusionAuth 这一产品 [作为 SaaS 解决方案](https://fusionauth.io/docs/get-started/run-in-the-cloud/cloud)，但许多用户选择在自己的服务器或笔记本电脑上运行 FusionAuth。

本文将重点关注销售并需要与现有应用进行集成的开发者工具，而不是独立的开发者工具，例如 IDE 或免费提供的产品。

本文所适用的工具类型示例包括：

- 消息队列
- 分析引擎
- 作为服务的授权解决方案
- 数据库
- 提供身份验证的身份提供者

但首先，您为什么要走这条路？

![一个人在选择构建 SaaS 和自托管软件之间。](https://scillidan.github.io/image_post/building-a-self-hostable-product_01.webp)

难道未来不属于软件即服务 (SaaS) 吗，在这里，开发人员通过互联网提供的 API 集成功能？难道自托管产品不是直接源于 2000 年代初，当时 Sourceforge.net 和 Freshmeat.net 是获取软件的方式？那时，不是称之为“软件”而不是“可下载软件”或“自托管软件”吗？

## 为什么构建自托管开发工具

有许多理由可以构建与其他应用程序集成的自托管开发工具。

### 为用户提供控制

主要原因是要让开发者拥有更多控制权。开发者喜欢控制，因为他们对其应用的整体性能和功能负责。如果他们无法控制其应用基础设施中的关键部分，当其应用出现故障时，他们无法修复。这是极其令人沮丧的。

与 SaaS 解决方案相比，特别是采用典型的多租户 SaaS 架构的解决方案，开发者确实拥有某种程度的控制权，但这是有限的。在使用 SaaS 产品时，开发人员让出了一些或全部以下方面的控制：

- 数据位置
- 性能
- 软件版本
- 可用性

作为 SaaS 提供商，您可以绕过某些限制。例如，可以 [对 API 进行版本控制](https://stripe.com/blog/api-versioning)，并且您可以提供多个地理区域的数据存储。但是是有限制的。您不太可能在希腊或津巴布韦建立服务器。例如，使用典型的 SaaS 解决方案，开发者显然无法像自托管时那样拥有更多控制。当然，这之间有得失；下面将对此进行更详细讨论。

作为开发工具提供商，如果您提供的产品可以在任何 Linux 或 Windows 服务器上托管，开发者将保留更多的控制权。用户可以在他们自己的硬件上运行该产品，使用自己的数据存储，在自己的网络中。

如果出现性能问题，他们可以进行故障排除。如果他们想最小化您的产品与他们服务之间的网络跳数，他们可以配置网络。如果由于负载导致服务或产品出现故障，他们可以增加服务器或限制流量。

如果他们需要将您的产品固定在某个特定版本，他们可以跳过升级，将产品视为库依赖。

![一个强调控制的维尼熊的模因。](https://scillidan.github.io/image_post/building-a-self-hostable-product_02.webp)

#### 隐私保障

隐私方面也有好处。客户可以通过检查网络、源代码或文档，确切知道向提供产品的公司发送了哪些数据。通过锁定外部连接或防止任何数据传输，可以确保数据的隐私。

当软件在本地运行时，开发者还可以保证数据在静态或传输中的加密。

SaaS 提供商可以提供关于数据隐私的法律保障。虽然 Facebook 并不是一家开发工具公司，但 [曾因员工阅读私信而解雇员工](https://www.vice.com/en/article/bjp9zv/facebook-employees-look-at-user-data)。但是，软件在本地运行使得违规变得不可能。

#### 数据位置

数据位置是一个越来越重要的控制方面。其重要性取决于您的应用所持数据的类型。对于某些地点的客户个人可识别信息（PII），例如欧洲或加州，您希望确切知道数据的去向。不这样做可能会因 GDPR 或其他法规导致严厉的惩罚。

这不仅仅是 PII。如果您有一个处理大量数据或高度专有及秘密信息的产品，更容易将产品带到数据旁边，而不是诱使或强迫客户将数据带到产品前面。构建自托管产品使这一点成为可能，让客户可以在他们的环境中运行您的应用。

#### 匿名性

通过让开发者工具自托管，您可以让开发者在不提供任何信息的情况下测试产品和学习如何使用它。这降低了评估时需要的努力程度。同时，也成为一种市场差异化。这可能会让习惯于获得更多潜在用户信息的营销团队感到沮丧。

**通过自己操作产品，您可以为客户提供对其数据的控制。** 这对开发者和客户都是有吸引力的。

除了为客户提供控制，还有其他好处。

### CI 简化

如果整个应用是自包含的，您可以在 CI 环境中轻松推出，例如 GitHub Actions 或 CircleCI。每个测试可以将已安装的软件配置到一个精确、已知的状态并独立运行。

FusionAuth 为此用 [Kickstart](https://fusionauth.io/docs/get-started/download-and-install/development/kickstart) 提供了支持，它是一种调用系统启动时 API 的自定义配置语言。您的产品可以采用类似的模式或提供 API、脚本或基础设施即代码（IaC），以允许配置正确的状态。

在这种情况下，多个开发人员在单一账户下运行，SaaS 解决方案可能会更慢且更脆弱。开发者是通过 CI 运行程序发起网络请求，而该环境与他们的笔记本电脑是不同的。配置 SaaS 服务可能会与其他开发者的测试发生冲突。您可以通过在 SaaS 产品中使用多个账户解决此问题，但这会导致您必须管理和 / 或支付这些账户的费用。

### 发现与分发

通过提供自托管产品和友好的开发者安装方法，开发者可以发现并集成您的产品，而无需与任何人交谈。这使得开发者能够在几乎没有成本的情况下，使用他们自己的硬件及其环境来评估您的解决方案。

一些此类安装方法包括：

- Homebrew
- Docker
- RPMs/DEBs
- Windows 安装包
- MacOS 磁盘映像
- Ruby Gems
- Maven 包
- Hyperscaler 市场

并非所有这些适用于每个自托管开发工具，但您应该考虑这些分发和发现方法。

利用这些免费和匿名的分发方法，使得获利变得更加复杂。自托管软件的商业模式挑战将在下文中讨论。

### 商业连续性

正如自托管软件增强了开发者的控制权，它也可以赋予企业同样的优势。自托管降低了商业连续性风险。如果您的公司失败、被收购或以其他方式停止运营，客户仍然可以继续运行您的产品。

这样做并不是长远解决方案，因为产品不会改进。但是如果企业依赖您的解决方案进行关键的业务流程，他们可以在评估替代方案时继续使用该产品。在找到解决方案后，他们可以根据集成工作的努力、安全风险、功能差距和其他问题，按照其时间表迁移。

与之对比的是，如果支持纯 SaaS 产品的公司失败或被收购，客户只有在公司或收购者的善意下才能继续使用应用程序或组件。如果某个组件至关重要，这可能会令人生厌。

最后，如果公司想要切换架构组件，自托管为他们提供了选项，因为他们可以访问数据。而 SaaS 产品可能没有或许提供完整功能的导出功能。

### 离线或网络支持有限

当您拥有自托管产品时，可以提供离线或受限网络可用性。一些受益于此功能的用例包括：

- 更好、更独立的开发环境。通过使用自托管组件，开发者可以在其笔记本电脑上运行整个应用及其所有组件，无需使用模拟器。虽然完全离线的地点变得越来越少（多亏了 Starlink！），但不依赖远程 API 或服务的感觉是相当自由的。本地服务更快地启动并更便于开发。
- 没有互联网连接或连接有限的地方，例如游轮和自助服务终端。
- 处理敏感数据的高安全场景。

如果您拥有一个不需要网络连接才能运行的自托管产品，您可以为这些情况服务客户。

### 您客户的预算

如果用户在自己的环境中运行自托管架构组件，他们可以像对待自己的应用程序一样控制成本。

这可能包括优化计算或网络，关闭开发环境，或根据需求的季节性变化或时间推移来扩展或缩减解决方案。

### 您的预算

自托管软件还可以降低您的开支。您销售产品，但由他们来运行。运营成本由客户承担。毕竟，这种控制不是免费的。

如果您将有价值的功能打包并销售为自托管软件，利润率可能会相当可观。

哇，希望您已经相信自托管软件的价值。接下来，让我们讨论在构建自托管架构组件时需要考虑的内容。

## 在构建自托管产品时需要考虑的事项

构建自托管产品时需要考虑的内容有很多。但最重要的是您的依赖。

![小女孩跑着，身旁有文字“您的产品需要什么才能运行？”](https://scillidan.github.io/image_post/building-a-self-hostable-product_03.webp)

您的产品需要什么依赖才能运行？

### 依赖

为了确保您尽量减少采用摩擦，尽量保持您所需依赖列表的尽可能小。这将使用户在部署和运营产品时的生活更轻松。这也将使支持工作更容易。

例如，如果您选择自托管，FusionAuth 需要以下组件：

- 关系数据库
- 可选的 Elasticsearch 或 OpenSearch 实例
- 可选的代理

就是这些。

让我们与 SaaS 应用进行对比。这样的应用不会随意包含不需要的组件或数据存储，但如果工程团队看到需要，他们有灵活性来使用它们。这可能是像 Kafka 这样的远程消息队列，像 Pinecone 这样的专用数据存储，甚至使用 S3。可以评估这些服务的功能与运维负担之间的权衡，并实施使用。

另一方面，要求您的客户学习如何运行 NoSQL 数据库存储或消息队列以使用您的产品，将给他们带来可能不愿承担的成本。保持所需依赖的最小化。

如果您使用像 JVM 这样的运行时，请将其打包在内。这样可以避免版本不兼容的问题。FusionAuth 绑定了已知版本的 Java；不支持其他版本。限制您的应用运行的环境将降低支持成本并提高客户满意度。

如果可以将所有依赖与您的产品一起打包，那会更好。您打包的第三方组件越多，您可以更紧密地控制依赖。

不过，这会牺牲灵活性。

例如，考虑一个产品依赖于关系数据库的情况。如果您不打包数据库，部署将更简单。指定您支持的数据库和版本，并要求客户提供这样的数据库。如果他们使用支持的数据库，他们可以将数据库操作经验广泛应用于多个应用。如果他们当前不使用支持的数据库，他们要么不会购买您的产品，要么就必须扩展其支持。意味着您希望针对 widely used 的解决方案，而不是打包。

哪一个？询问您的潜在客户。FusionAuth 支持 MySQL 和 PostgreSQL。如果您面向企业，Oracle 可能更合适。如果您面向嵌入式开发者，SQLite 是一个不错的选择。

特别是有关系数据库的情况下，提供架构管理机制。如果您支持多个数据库，您交付的架构必须支持每个数据库。不要使用一个数据库中不可用的高级功能。您还需要测试所有支持数据库的所有版本的性能。

另一方面，如果您打包数据库，您将与打包运行时获益于同样的好处：更多控制、更少的兼容性问题、更简化的安装。但是最终用户不一定能够利用他们在数据库运行中的经验进行操作。

对于每个第三方组件，请考虑您是否应该将其打包，从而为支持团队和用户在安装时简化工作，还是将其解包以便使自托管客户操作您的软件更容易。

#### GPL

如果您使用任何根据 GPL 或类似许可证授权的组件或库，并且向客户提供了二进制程序，您必须同时提供给他们源代码访问权限。一个例子是 Java 的 MySQL 库，它是 GPL 的。您可以通过记录如何下载和安装 GPL 依赖来解决此问题。

SaaS 公司不必担心 GPL，因为他们提供的功能而不是可执行代码。

### 部署流程

交付自托管软件时，还有一个技术障碍。与 SaaS 相比，后者的部署过程通常是“访问这个 API”或“登录到这个应用程序”，而自托管解决方案的安装将更加复杂。然而，请尽量使产品的安装和部署尽可能简单。

安装是开发者第一次接触到您的软件的体验。编写详细的安装文档。确保其涵盖所有支持的路径。上述提到的支持多种分发机制的多样性是积极的，因为您通过 Maven、Docker 等途径免费分发工具。好吧，这些方法并非完全免费——您编写和更新以支持这些工具的文档是您需要支付的代价。

最佳的安装体验不是文档，而是安装脚本或其他可执行方法。计划支持多个安装路径。您期望客户在何处运行软件，特别的方法包括：

- 硬件选项，诸如虚拟机、容器和物理服务器
- 操作系统，诸如 Windows、MacOS 和 Linux
- 分发机制，例如 Homebrew、RPMs 和 Docker
- 主要组件的依赖关系，包括云版本

您可以通过使用像 JVM 这样的虚拟机或像 golang 这样的跨编译语言，来抽象掉硬件和操作系统的差异。

### 网络就是计算机

访问网络即使通常被假定也是一种依赖。与 SaaS 解决方案不同，自托管产品可以在没有网络访问的情况下工作。

将此视为您产品的差异化优势。

出于技术原因，您可能对某些功能需要网络访问。例如，检索许可证或下载大量数据以启用高级功能，下载数据的功能要求网络流量。例如，FusionAuth 拥有一组被泄露的密码，其规模过大，无法与自托管可执行文件一起发货，并且是付费功能的一部分。构建可靠的重试逻辑，以便如果磁盘满或网络不稳定，可以仍然下载数据。

如果您希望提供真正的隔离体验，不需要网络访问，那么请考虑如何提供此类功能或验证许可证是否合法。

### 工具

作为开发者，您知道有许多工具和架构组件可以帮助您构建更好的产品。这些可以轻松添加的功能包括：

- 了解功能的使用情况，比如 HotJar
- 寻找错误，比如 Sentry
- 特性标志，比如 LaunchDarkly
- 通知功能，比如 Knock
- Webhook 处理，比如 Svix

这些解决方案中的许多是作为 SaaS 产品构建的，并通过需网络的 API 或 SDK 提供。确保您理解任何您评估的工具是哪种类型。

如果需要网络，那么抱歉，它将不再是一个选项。您可以从这些工具中寻找灵感，但任何只期望在 SaaS 中使用的东西通常会被排除在外。

### 发布

使用 SaaS 产品，您可以相对轻松地前进或后退版本。这通常通过 CI/CD 完成。如果没有完全自动化，您可以控制服务器端代码。客户端 JavaScript 可能会被缓存，移动应用将由于审核流程而需要更长的更新时间。感谢苹果！

通过服务器端控制，您可以发布您的更改并在现实世界中进行测试。通过让部分用户经过新代码路径，您可以在不影响整个用户群的情况下测试是否会发生任何故障，使用工具如 [GitHub scientist](https://github.com/github/scientist)。使用蓝绿部署，您可以（如果您的架构和数据存储支持的话）启动一个完全独立的应用程序实例，轻轻地将流量转移到它，或者，如果新代码导致某些东西出现故障，也可以将流量转回去。

发布自托管产品则有所不同。

![一个人手里拿着叉子，标题是“打击方式不同”，上方有“部署过程”和“依赖性”的字样。](https://scillidan.github.io/image_post/building-a-self-hostable-product_04.webp)

您对客户的部署时机和方式的控制有限。请记住，作为自托管产品开发者，您将这种权力交给了他们。但此时，您对客户的升级或降级的能力有限。

因此，在发布时您需要确保软件的缺陷尽可能少。您需要对所有受支持的平台、架构组件和部署场景进行严格的测试。这项工作在所需的功能和错误修复测试之外，应该超过任何可靠的软件产品的要求，无论是自托管的还是 SaaS 的。

您可以绕过某些限制。例如，您可以构建自动升级功能，就像 Chrome 浏览器那样。如果您这样做，请处理网络连接问题，并确保您的用户了解他们安装的是将自动升级的自托管工具。将其与浏览器中的升级放在一起是一回事，但对于像消息队列或数据库这样的开发工具，则更具风险。您的开发者客户必须清楚他们的应用依赖的组件将会发生怎样的变化。

您还可以构建支持升级回滚功能。请花时间构建工具和基础设施，以可靠、独立的方式处理这些变更。

另一个更简单的试点选项是提供测试版或早期访问程序，让客户自选运行您软件的版本。这些版本不会向公众开放，也不如正式发布那么无错误。提前访问的安装可以在客户的自主选择下进行，但依然可以提供有价值的反馈。

发布的复杂性意味着您必须记录和构建系统，使用户清楚了解生产升级的影响。这是一个常见的软件问题，并且有几种方法可供选择，包括分离控制和数据平面，并维护严格的 n-1 版本向后兼容性。

如果您提供回滚并依赖 RDBMS，请确保模式更改不会破坏或降低将使回滚不可能的数据的完整性。这些包括删除列或将列更改为精度较低的数据类型。

无论您的发布策略是什么，都不要忘记文档！构建在您的自托管产品上的开发人员在升级以利用新功能时会需要它。

### 发布沟通

除了发布流程和客户影响的核心细节，您还必须让用户了解这一点。毕竟，如果他们不知道，他们就不会升级。

您必须告知用户您的包的新版本已可用。在 FusionAuth 中，我们提供：

- RSS 提要
- 一般新版本电子邮件列表
- 专注于安全的电子邮件列表
- 自动或手动直接与客户的沟通（在适当时）

另一个选择是在应用内提醒。哦，我是说提醒。根据用户与工具的互动方式，这可能会有效。然而，如果您的工具通过 API 或命令行驱动，那么您周到的提醒可能永远不会被看到。

计划花一些时间来建立适当的沟通机制。

### 性能

在每次发布之前，花时间在多个环境中测试性能，以确保没有性能回归。

需要测试的维度包括：

- 系统中的数据量
- 硬件差异
- 依赖版本
- 您支持的主要架构组件（如不同的数据库）

### 了解产品使用情况

您是否曾经使用过工具来知道哪些用户使用了您产品的哪些功能？或者哪个新用户组与以前的用户相似？此类工具帮助 SaaS 供应商无处不在地更好地了解客户并更高效地运作。惊喜！在您开发自托管产品时，这种工具不适合您。除非你自己构建它。

即使您确实构建了它，也要警惕报告过多数据或任何可能让客户感到不适的数据。您报告的数据越多，对用户隐私的影响就越大，而增强隐私是自托管的一个重要方面。

只捕获您需要改善产品的信息，明确您正在记录的内容，并在使用数据与存储在系统中的私人数据之间划定明确界限。例如，如果您拥有一个具有重试功能的队列系统，记录该功能的使用是可以的。但是记录正在重试的整个消息则不可行。向您的客户明确说明您正在收集的信息以及原因。给他们一个选择关闭的机会。

自托管客户可以超越关闭，并阻止网络访问，这将禁用使用统计报告。提前意识到这一点可能会导致数据减少，但信任会增加。

实际用户在使用您的软件时，资源和限制可能与您预期的不同。当他们运行您的软件时，会发现问题。提供手动和自动沟通渠道，以捕获这些问题。您可以评估、优先排序并解决它们。

![一个杰夫·高布伦的模因，这上面写着“用户总会找到方法”。](https://scillidan.github.io/image_post/building-a-self-hostable-product_05.webp)

如果使用基于使用的定价是您的商业模式的一部分，某种程度的报告也可能是收费客户所需。

### 支持

提供优秀的客户支持对于自托管产品而言比 SaaS 产品更为困难。您不仅需要回答有关如何使用产品的问题，还要回答有关如何安装和操作的问题。这些方面可能，如上所述，是小众的，或者以意想不到的方式扭转您的产品。实际上，开发者经常依赖于未记录但可观察到的特性； [见赫里姆法则](https://www.hyrumslaw.com/)。在此基础上，您还需要支持异构的部署环境。

在这样的世界中，如何设立测试环境以复制问题？通常，直接与客户进行电话交流以查看其部署环境会更有效。

越多的打包，复制问题就越容易，因为您的产品越多地已知并在您的控制之下。

另一个难点是。除非您选择 Chrome 的自动升级模型，否则您的客户和用户将使用不同版本。思考如何支持他们。您将支持哪个老版本？如果客户向您支付大量资金怎么办？

#### LTS

当自托管产品有足够的版本时，考虑建立与 Linux 发行版或编程语言相似的长期支持 (LTS) 计划。LTS 允许使用您工具的开发人员升级到特定版本，并长期保持在这些版本上。关键的自托管产品与编程语言共享许多相似之处。用户可能不愿意投资以定期升级您的产品。新功能可以鼓励升级，但一旦您的产品满足了他们的需求，他们就不会再费心。

由于所有客户和用户没有运行相同版本的软件，反向修复bug会成为一个问题。这样做增加了开发复杂性，但提供了更多稳定性。反向修复可以包括安全修复以及选定的错误。

您将反向修复哪些？您将向前修复哪些？是否有仅适用于 LTS 的修复？这些都是您必须在自托管工具旅程中的某个时刻面对的问题。

## 客户赋能

以上是您和您的工程团队在构建自托管产品时需要考虑的主题。但除了技术考虑外，您的客户还需要什么来取得成功？

操作软件是困难的。这就是为什么许多人更喜欢 SaaS 解决方案，它们在操作简便性上交换了控制权。然而，团队通常会在云中或自己的硬件上运行其应用程序。这些应用程序以公司所需的规模和性能运行。因此，对于某些子集客户而言，控制能力的可用性值得其运行成本，因为它们本来就有。

为帮助减少这种痛苦，提供优秀的文档以赋权于客户。

这包括有关详细文档的信息：

- 安装
- 扩展
- 性能调优
- 监控
- 故障排除
- 系统要求
- 基础设施集成
- 工具集成
- 升级

尽可能使这些文档详尽、准确且完整。它们是产品体验的一部分。明确标记适用的版本，因为随着软件的演变，功能和要求将发生变化。

您的软件可以安装或操作的可能组合几乎是无限的。试着通过记录常见的集成和互补软件组件来限制努力。例如，FusionAuth 可以与任何代理一起使用，但提供 [存储库](https://github.com/fusionauth/fusionauth-contrib) 其中包含常用配置的 NGINX、CloudFront 等。

在发布说明中清楚记录变更。您可以使用低保真度方法来沟通，如遵循 [语义版本管理，也称为 SemVer](https://semver.org/)，或使用高保真度的方法，如 [旧式发布说明](https://fusionauth.io/docs/release-notes/)。

### 配置管理

有信心执行自托管关键基础设施的组织通常利用配置管理或 IaC。它们希望通过 API 或诸如 Terraform 或 Pulumi 的工具对您的产品或应用进行配置。

提供此功能使您的客户能够以与管理应用基础设施的其他更改相同的方式管理对产品的更改。

Terraform 和 / 或 OpenTofu 是这一领域的最大参与者，但请计划好如何回答问题“我们如何跨环境和时间配置您的产品”？

### 专业服务

啊，这是每个软件公司的毛利率之痛。但不管怎样，专业服务帮助客户快速有效地实施您的产品。它还有助于在早期为您带来收入，并帮助您了解您的产品解决了哪些客户问题。

如果您不想建立自己的专业服务组织，请与能够做到的咨询公司建立关系。但是，参与此体验的双方都希望另一方能为他们带来客户并为他们赚钱。这些关系可能很难发起，但如果时间跨度足够长且双方承诺得以落实，它们是仍然可以成功的。价值增值转售商 (VAR) 在过去几十年中一直是软件销售渠道的原因之一。

## 什么类型的软件是合适的

并非所有类型的开发工具都适合作为自托管解决方案。但是如果您的产品具有以下三种或更多的属性：

- 具有离线使用案例
- 吸引熟悉操作软件的客户
- 解决关键问题
- 与现有应用或组件集成
- 替代现有解决方案
- 提供被许多应用使用的功能

那么，自托管解决方案可能正是您的需求。

## 货币化

如果您希望销售自托管产品，您有几个选择。

![杰瑞·马奎尔在电话中大喊“给我商业模式”。](https://scillidan.github.io/image_post/building-a-self-hostable-product_06.webp)

- 高级支持，可能带有服务水平协议（SLA）
- 高级功能，通过软件许可证管理访问权限
- 托管，您为用户运行产品，他们作为 SaaS 消费它
- 如果您的产品是 GPL 或类似的，将其依据商业友好的许可证销售相同代码
- 提供定制开发或专业服务，如上所述

每种都有优缺点。

高级支持相对容易提供。您可以允许客户支付访问 Slack 频道、工单系统或电子邮件地址的费用，该地址在其他支持机制中优先。不过，这需要员工、招聘和培训。与软件业务的其他部分相比，它的规模扩展能力更差。对于自托管产品，提供支持可能会很复杂，如上所述。

高级功能能够在不增加成本的情况下扩大收入，但需要巨大的前期投资来构建。它们还需要一个许可证系统。这通常需要网络访问，这会失去离线好处。您还要确保核心产品在没有高级功能的情况下可用。仔细选择哪些功能是高级的，哪些不是。

通过托管，自托管产品的单租户 SaaS 自然适合。您可以根据客户需求和集成接口稳定性，提供客户控制的升级或完全托管的 SaaS。不过，这不是免费的钱。您现在负责可用性、性能和运营软件的其他方面。

“您托管，还是我们托管”的选项允许您提供一些 SaaS 的好处，而不失去所有自托管解决方案的好处。这可能对客户很有吸引力。他们可以选择先自托管以控制或降低成本，或者便捷地迁移到 SaaS，或者可以快速上手地选择 SaaS，迁移到自托管，等到他们的团队准备好运行软件并希望获得更多控制时再进行迁移。

如果您的许可证在商业使用方面存在问题，提供更商业友好的次要许可证是一种不错的赚钱方式。这在 MySQL 的案例中运作良好。

定制开发和专业服务提供了一条帮助采用和确保客户成功的收入途径。但是，您必须招聘和培养该团队，并且利润率较低，像支持一样。

随着自托管软件的进步，您的商业模式可能会发生变化。例如，最初，您可能想进行定制开发，但如果您然后建立托管提供，您可能会低调定制开发，以便进行更高利润的托管业务。

无论您做什么，清晰有效地与客户沟通变化。

### 开源问题

自托管架构组件 _可以_ 是开源软件（OSS），但这不是必需的。OSS 有很多好处：

- 增加社区反馈
- 修复错误
- 降低摩擦采用
- OSS 光环

但也有替代方案。您可以提供免费作为啤酒的版本。通过这样做，您获得了许多开放源码带来的市场和分发利益，而没有商业模式的风险。您还可以使用非 OSS 许可证，比如商业源许可证。

提供您的产品作为开源软件的风险包括：

- 别人转售您的产品
- 如果社区不同意产品决定而进行的分叉
- 有限的货币化选项

另一方面，如果您不是 OSS，您将无法获得光环效应，建立信任会更加困难，而构建社区也更具挑战性。

最近有太多的重新许可证事件，例如 Elasticsearch 和 Terraform，使得开发人员知道仅仅因为一个产品最初是开源的，并不意味着它会一直保持开源。强调您在构建可持续企业的论点，可能会对某些用户产生吸引力，但对其他人来说，根本上没有充分的 OSS 将无法满足他们的需求。

这都很好，您不需要为每个人构建产品。无论哪种方式，请准备好捍卫您的决定。

## 结论

构建自托管开发工具具有独特的价值。

- 您可以服务某类能够并希望操作自身基础设施的客户。
- 有些用例您可以满足。
- 您可以以 SaaS 无法解决的方式满足技术和业务需求。
- 有更多的分发渠道可用。

同时也有相应的技术挑战：

- 客户需要支持工具和文档。
- 您需要尽量减少依赖，但不能过度减少。
- 支持需要处理异构环境和旧版本。
- 工程需要调整以应对无法回滚的发布和更有限的工具。

最后，您有多种货币化选择，复杂性和利润率各异。

自托管在重视控制、数据位置和具备操作软件技能的客户中正卷土重来。

现在您知道在构建强健自托管软件时应该考虑哪些方面。

[GPT-4o mini]

